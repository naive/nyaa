#!/usr/bin/env ruby

require 'rubygems' # for ruby 1.8
require './lib/nyaa' # for testing

opts = Nyaa::CLI.parse(ARGV)
close = false

# Batch mode
# TODO: This needs a proper implementation
if opts[:batch]
  nyaa = Nyaa::Search.new(opts[:query], opts[:category], opts[:filter])
  results = nyaa.more.get_results
  results.each do |r|
    puts "o #{r.name}"
    puts "#{r.link}"
    puts
  end
  exit
end

begin
  if opts[:curses]
    nyaa = Nyaa::UI.new(opts)
    until done do
      nyaa.header
      nyaa.footer
      nyaa.render

      key = nyaa.read
      if key == 'q'
        close = true
      end
    end

    nyaa.close
  else
    nyaa = Nyaa::Browser.new(opts)
  end
rescue Interrupt
  puts "\nInterrupt received. Exiting."
  exit
end
